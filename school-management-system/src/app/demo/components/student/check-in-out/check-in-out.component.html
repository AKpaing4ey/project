<div class="grid">
    <div class="col-12">
        <div class="card">
            <div class="text-center mb-4">
                <h4 class="text-primary mb-2">
                    <i class="pi pi-clock mr-2"></i>
                    Student Attendance Portal
                </h4>
                <p class="text-600 m-0">Check In and Check Out for Today</p>
            </div>
            
            <p-toast key="tst"></p-toast>
            
            <!-- User Info -->
            <div class="mb-4 p-3 surface-100 border-round">
                <div class="flex align-items-center">
                    <i class="pi pi-user text-primary text-xl mr-3"></i>
                    <div>
                        <h6 class="mb-1">Welcome, {{ user_name }}</h6>
                        <p class="text-600 m-0 text-sm">Role: {{ user_role }}</p>
                    </div>
                </div>
            </div>

            <!-- Today's Status Card -->
            <div class="mb-4" *ngIf="todayAttendance">
                <div class="p-3 border-round" 
                     [ngClass]="todayAttendance.checkOut_time ? 'surface-green-50 border-green-200' : 'surface-orange-50 border-orange-200'">
                    <div class="flex align-items-center mb-2">
                        <i class="pi pi-calendar text-primary mr-2"></i>
                        <h6 class="mb-0">Today's Attendance Status</h6>
                    </div>
                    <div class="grid">
                        <div class="col-12 md:col-6">
                            <div class="flex align-items-center mb-2">
                                <i class="pi pi-sign-in text-green-600 mr-2"></i>
                                <span class="font-semibold">Check-in:</span>
                            </div>
                            <p class="text-900 ml-4 mb-0">{{ convertToMyanmarTime(todayAttendance.checkIn_time) }}</p>
                        </div>
                        <div class="col-12 md:col-6" *ngIf="todayAttendance.checkOut_time">
                            <div class="flex align-items-center mb-2">
                                <i class="pi pi-sign-out text-blue-600 mr-2"></i>
                                <span class="font-semibold">Check-out:</span>
                            </div>
                            <p class="text-900 ml-4 mb-0">{{ convertToMyanmarTime(todayAttendance.checkOut_time) }}</p>
                        </div>
                    </div>
                    <div class="mt-2" *ngIf="!todayAttendance.checkOut_time">
                        <p class="text-orange-600 font-semibold mb-0">
                            <i class="pi pi-exclamation-triangle mr-1"></i>
                            Status: Checked In (Please check out when leaving)
                        </p>
                    </div>
                </div>
            </div>

            <!-- Check-in/Check-out Section -->
            <div class="mb-4" *ngIf="!todayAttendance || (todayAttendance && !todayAttendance.checkOut_time)">
                <div class="p-3 border-round" 
                     [ngClass]="todayAttendance ? 'surface-orange-50 border-orange-200' : 'surface-blue-50 border-blue-200'">
                    
                    <!-- Check-in State -->
                    <div *ngIf="!todayAttendance">
                        <div class="flex align-items-center mb-3">
                            <i class="pi pi-sign-in text-blue-600 text-xl mr-2"></i>
                            <h5 class="mb-0 text-blue-900">Check In</h5>
                        </div>
                        <p class="text-600 mb-3">Select your class and check in to start your day</p>
                        
                        <div class="field">
                            <label for="class" class="font-semibold">Select Class</label>
                            <p-dropdown 
                                [options]="classes" 
                                [(ngModel)]="selectedClass" 
                                optionLabel="name"
                                [filter]="true" 
                                filterBy="name" 
                                id="class" 
                                placeholder="Choose your class"
                                class="w-full"
                                [showClear]="false">
                            </p-dropdown>
                        </div>
                    </div>

                    <!-- Check-out State -->
                    <div *ngIf="todayAttendance && !todayAttendance.checkOut_time">
                        <div class="flex align-items-center mb-3">
                            <i class="pi pi-sign-out text-orange-600 text-xl mr-2"></i>
                            <h5 class="mb-0 text-orange-900">Check Out</h5>
                        </div>
                        <p class="text-600 mb-3">You're currently checked in. Click below to check out when you're leaving.</p>
                    </div>
                    
                    <!-- Dynamic Button -->
                    <button 
                        pButton 
                        type="button" 
                        [label]="todayAttendance ? 'Check Out Now' : 'Check In Now'" 
                        [icon]="todayAttendance ? 'pi pi-sign-out' : 'pi pi-sign-in'" 
                        [class]="todayAttendance ? 'p-button-warning w-full' : 'p-button-success w-full mt-3'"
                        [disabled]="!todayAttendance && !selectedClass"
                        (click)="todayAttendance ? checkOut() : checkIn()">
                    </button>
                </div>
            </div>


            <!-- Completion State -->
            <div class="mb-4" *ngIf="todayAttendance && todayAttendance.checkOut_time">
                <div class="p-4 surface-green-50 border-round border-green-200 text-center">
                    <i class="pi pi-check-circle text-green-600 text-4xl mb-3"></i>
                    <h5 class="text-green-900 mb-2">Attendance Complete!</h5>
                    <p class="text-green-700 mb-0">You have successfully completed your attendance for today.</p>
                    <p class="text-green-600 text-sm mt-2 mb-0">
                        Check-in: {{ convertToMyanmarTime(todayAttendance.checkIn_time) }} | 
                        Check-out: {{ convertToMyanmarTime(todayAttendance.checkOut_time) }}
                    </p>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-column gap-2 mt-4">
                <button 
                    pButton 
                    type="button" 
                    label="Logout" 
                    icon="pi pi-sign-out" 
                    class="p-button-secondary"
                    (click)="logout()">
                </button>
            </div>
        </div>
    </div>
</div>
